<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0/EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="auction.guad.mapper.SellItemResultMapper">

	<!-- 상품 구매 -->
	<insert id="insertSellItemResult"
		parameterType="auction.guad.vo.RequestTradeVo">
		INSERT INTO SELL_ITEM_RESULT
		(ITEM_NUM, SELL_TYPE, SELLER_EMAIL, SELLER_PHONE, BUYER_EMAIL,
		BUYER_PHONE, ADDRESS, ITEM_SUB, ITEM_PRICE, SOLD_DATE)
		VALUES(#{itemNum},
		#{sellType}, #{sellerEmail}, #{sellerPhone}, #{buyerEmail},
		#{buyerPhone}, #{address}, #{itemSub}, #{itemPrice}, now())
	</insert>

	<!-- 구매기록 조회 / 아이디 + desc limit 1 -->
	<select id="selectOneByBuyerEmailAndItemNum"
		resultType="auction.guad.vo.RequestTradeVo">
		SELECT R.*, M.NICKNAME, I.ITEM_CONTENTS FROM SELL_ITEM_RESULT R LEFT JOIN
		SELL_ITEM I ON R.ITEM_NUM = I.ITEM_NUM
		LEFT JOIN MEMBER M ON R.SELLER_EMAIL = M.EMAIL WHERE BUYER_EMAIL = #{buyerEmail}
		AND I.ITEM_NUM = #{itemNum};
		</select>
		
	<!-- 마이페이지 구매내역 리스트 -->
	<select id="selectMyBuyList" resultType="auction.guad.dto.SellItemResultDto">
	   SELECT * FROM SELL_ITEM_RESULT WHERE BUYER_EMAIL = #{memberEmail}
	</select>
	
	<!-- 마이페이지 판매내역 리스트 -->
	<select id="selectMySellList" resultType="auction.guad.vo.RequestTradeVo">
	SELECT I.ITEM_CONTENTS, I.ITEM_NUM, I.ITEM_SUB, I.SELL_TYPE, I.SOLD_YN, I.ITEM_PRICE, I.SELL_STATE, 
	R.SELLER_EMAIL, R.SELLER_PHONE, R.BUYER_EMAIL, R.BUYER_PHONE, R.ADDRESS, R.SOLD_DATE FROM SELL_ITEM I 
	LEFT JOIN SELL_ITEM_RESULT R ON I.ITEM_NUM = R.ITEM_NUM WHERE MEMBER_EMAIL = #{memberEmail} 
	ORDER BY I.WRITE_DATE DESC
	</select>
	
</mapper>
